<script lang="ts" setup>
import { onMounted, ref } from 'vue';
import { $API } from 'src/plugins/api';
import { Settings } from 'src/types/settings.interface';
import { Notify } from 'quasar';

defineOptions({
  name: 'SettingsText',
});

const settings = ref<Settings>();
const isLoading = ref<boolean>(false);
const updateFaqText = () => {
  if (!settings.value || !settings.value.faqText) return;
  isLoading.value = true;
  $API.updateFaqText(
    {
      faqText: settings.value.faqText,
    },
    (response: Settings) => {
      settings.value = response;
      isLoading.value = false;
      Notify.create({
        message: '‚ò∫Ô∏è –¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –û–±–Ω–æ–≤–ª–µ–Ω',
        color: 'positive',
        timeout: 1500,
      });
    },
    (e: any) => {
      console.log(e);
      isLoading.value = false;
    }
  );
};

const updatePriceText = () => {
  if (!settings.value || !settings.value?.priceText) return;
  isLoading.value = true;
  $API.updatePriceText(
    {
      priceText: settings.value?.priceText,
    },
    (response: Settings) => {
      settings.value = response;
      isLoading.value = false;
      Notify.create({
        message: '‚ò∫Ô∏è –¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –û–±–Ω–æ–≤–ª–µ–Ω',
        color: 'positive',
        timeout: 1500,
      });
    },
    (e: any) => {
      console.log(e);
      isLoading.value = false;
    }
  );
};

const updateSupportText = () => {
  if (!settings.value || !settings.value?.supportText) return;
  isLoading.value = true;
  $API.updateSupportText(
    {
      supportText: settings.value?.supportText,
    },
    (response: Settings) => {
      settings.value = response;
      isLoading.value = false;
      Notify.create({
        message: '‚ò∫Ô∏è –¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –û–±–Ω–æ–≤–ª–µ–Ω',
        color: 'positive',
        timeout: 1500,
      });
    },
    (e: any) => {
      console.log(e);
      isLoading.value = false;
    }
  );
};

const updateAboutText = () => {
  if (!settings.value || !settings.value?.aboutText) return;
  isLoading.value = true;
  $API.updateAboutText(
    {
      aboutText: settings.value?.aboutText,
    },
    (response: Settings) => {
      settings.value = response;
      isLoading.value = false;
      Notify.create({
        message: '‚ò∫Ô∏è –¢–µ–∫—Å—Ç —É—Å–ø–µ—à–Ω–æ –û–±–Ω–æ–≤–ª–µ–Ω',
        color: 'positive',
        timeout: 1500,
      });
    },
    (e: any) => {
      console.log(e);
      isLoading.value = false;
    }
  );
};
onMounted(() => {
  $API.getSettings(
    (response: Settings) => {
      settings.value = response;
    },
    (e: any) => {
      console.log(e);
    }
  );
});
</script>

<template>
  <q-chip class="text q-mb-md">
    –ß—Ç–æ–±—ã –≤—ã–¥–µ–ª–∏—Ç—å —Ç–µ–∫—Å—Ç &nbsp;<b>–∂–∏—Ä–Ω—ã–º</b> &nbsp;–∑–∞–∫–ª—é—á–∏—Ç–µ –µ–≥–æ –º–µ–∂–¥—É
    —Ç–µ–≥–∞–º–∏&nbsp;
    <code>{{ `<b>–í–∞—à —Ç–µ–∫—Å—Ç</b>`}}</code>
  </q-chip>
  <div v-if="!!settings" class="container">
    <div class="item">
      <h4 class="item__title" v-text="'–¢–µ–∫—Å—Ç –¥–ª—è –í–æ–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç'" />

      <q-input
        v-model="settings.faqText"
        autogrow
        class="q-mb-sm item__input"
        filled
      />
      <q-btn
        :disable="isLoading || !settings.faqText"
        class="full-width item__button"
        color="primary"
        label="–ò–∑–º–µ–Ω–∏—Ç—å"
        standout
        unelevated
        @click.stop="updateFaqText"
        @keyup.enter="updateFaqText"
      />
    </div>
    <q-separator class="separator" />
    <div class="item">
      <h4 class="item__title" v-text="'–¢–µ–∫—Å—Ç –¥–ª—è üíµ –°—Ç–æ–∏–º–æ—Å—Ç—å —É—Å–ª—É–≥'" />

      <q-input
        v-model="settings.priceText"
        autogrow
        class="q-mb-sm item__input"
        filled
      />
      <q-btn
        :disable="isLoading || !settings.priceText"
        class="full-width item__button"
        color="primary"
        label="–ò–∑–º–µ–Ω–∏—Ç—å"
        standout
        unelevated
        @click.stop="updatePriceText"
        @keyup.enter="updatePriceText"
      />
    </div>

    <q-separator class="separator" />
    <div class="item">
      <h4 class="item__title" v-text="'–¢–µ–∫—Å—Ç –¥–ª—è –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É'" />

      <q-input
        v-model="settings.supportText"
        autogrow
        class="q-mb-sm item__input"
        filled
      />
      <q-btn
        :disable="isLoading || !settings.supportText"
        class="full-width item__button"
        color="primary"
        label="–ò–∑–º–µ–Ω–∏—Ç—å"
        standout
        unelevated
        @click.stop="updateSupportText"
        @keyup.enter="updateSupportText"
      />
    </div>

    <q-separator class="separator" />
    <div class="item">
      <h4 class="item__title" v-text="'–¢–µ–∫—Å—Ç –¥–ª—è ‚ÑπÔ∏è0 —Å–µ—Ä–≤–∏—Å–µ'" />

      <q-input
        v-model="settings.aboutText"
        autogrow
        class="q-mb-sm item__input"
        filled
      />
      <q-btn
        :disable="isLoading || !settings.aboutText"
        class="full-width item__button"
        color="primary"
        label="–ò–∑–º–µ–Ω–∏—Ç—å"
        standout
        unelevated
        @click.stop="updateAboutText"
        @keyup.enter="updateAboutText"
      />
    </div>
  </div>
  <q-skeleton v-else height="150px" />
</template>

<style lang="scss" scoped>
.item {
  max-width: 600px;
  margin-bottom: 3rem;
}

.separator {
  margin-bottom: 3rem;
}
</style>
