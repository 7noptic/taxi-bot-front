import{Q as ae,a as X,b as K,c as N}from"./QCard.440d414a.js";import{$ as A,Q as Y}from"./QInput.76567d60.js";import{j as J,r as d,w as G,i as Z,y as ee,m as o,n as m,p as s,ab as Q,q as i,A as v,B as H,F as f,ac as F,t as r,u as p,z as k,_ as le,ad as S,s as y,ae as j,a as M,af as te,ag as oe,Q as se,a9 as ne}from"./index.327b4700.js";import{Q as re,c as R,a as ie,b as de,T as ce}from"./TableSkeleton.772c2dc2.js";import{e as W}from"./helpers.5a00600a.js";import{M as P}from"./mode.table.8dd12f40.js";import{_ as ge}from"./CopyText.9704d296.js";import{Q as ve}from"./QChatMessage.e2a8fe9c.js";import{Q as pe}from"./QDrawer.cf49ccae.js";import{Q as me,T as fe,C as Ee,a as Ce}from"./TableOrder.b3289eea.js";import{Q as be,a as _e}from"./QLayout.7d74878c.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import"./use-dark.5b66a423.js";import"./QItem.cb161c91.js";import"./axios.4e4c9ce2.js";import"./QList.421edf4a.js";import"./touch.9135741d.js";import"./QSkeleton.e61b48c4.js";import"./QResizeObserver.bc18afd9.js";const Pe={class:"text-h4"},ye={key:1,style:{"max-width":"500px"}},ke=J({name:"ModalPassenger",__name:"Passenger",props:{modelValue:{type:Boolean,default:!1},chatId:{default:0}},emits:["update:modelValue"],setup(U,{emit:x}){const D={username:"Username",phone:"\u041D\u043E\u043C\u0435\u0440 \u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0430",last_name:"\u0424\u0430\u043C\u0438\u043B\u0438\u044F",city:"\u0413\u043E\u0440\u043E\u0434",address:"\u0410\u0434\u0440\u0435\u0441\u0430",createdAt:"\u0421\u043E\u0437\u0434\u0430\u043D",leftReview:"\u041E\u0441\u0442\u0430\u0432\u0438\u043B \u043E\u0442\u0437\u044B\u0432\u043E\u0432",countOrders:"\u0412\u0441\u0435\u0433\u043E \u0437\u0430\u043A\u0430\u0437\u043E\u0432",driveCount:"\u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043F\u043E\u0435\u0437\u0434\u043E\u043A",deliveryCount:"\u041A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u0434\u043E\u0441\u0442\u0430\u0432\u043E\u043A",canceledCount:"\u041E\u0442\u043C\u0435\u043D\u0435\u043D\u043E \u0437\u0430\u043A\u0430\u0437\u043E\u0432",averageRating:"\u0420\u0435\u0439\u0442\u0438\u043D\u0433",receivedReview:"\u041F\u043E\u043B\u0443\u0447\u0438\u043B \u043E\u0442\u0437\u044B\u0432\u043E\u0432",notes:"\u0417\u0430\u043C\u0435\u0442\u043A\u0438"},n=d([]),C=d(!1),c=U,E=d(!1),b=d(""),B=x,u=d(),g=d(c.modelValue),h=d(!1),_=d(!1),I=a=>{n.value=a,C.value=!0},q=a=>{if("address"in a)return[`\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435: ${a.name}`,`\u0410\u0434\u0440\u0435\u0441: ${a.address}`];if("orderId"in a)return[`\u0417\u0430\u043A\u0430\u0437: ${a.orderId}`,`\u0422\u0435\u043A\u0441\u0442: ${a.text}`];if("chatId"in a)return[a.text]},z=()=>{var l;const a={chatId:(l=u.value)==null?void 0:l.chatId,text:b.value};A.sendNotes(a,e=>{console.log(e),Q.create({message:"\u0417\u0430\u043C\u0435\u0442\u043A\u0430 \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430",color:"positive",timeout:1e3}),T(),E.value=!1},e=>console.log(e))};G(()=>g.value,a=>B("update:modelValue",a)),G(()=>c.modelValue,a=>g.value=a),G(()=>c.chatId,()=>T());const O=async()=>{var a;h.value=!0,await A.updatePassenger(c.chatId,{isBlocked:!((a=u.value)!=null&&a.isBlocked)},l=>{u.value.isBlocked=l.isBlocked},l=>{Q.create({message:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A\u{1F61E}...",color:"negative",timeout:1e3}),console.log(l)}),h.value=!1},T=()=>{c.chatId!==0&&A.getFullPassengerInfo(c.chatId,a=>{u.value=a},a=>{Q.create({message:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A\u{1F61E}...",color:"negative",timeout:1e3}),console.log(a)})},V=Z("bus"),$=()=>{var a;_.value=!0,A.deletePassenger((a=u.value)==null?void 0:a.chatId,l=>{console.log(l),l?(V.emit("update-passengers"),g.value=!1,_.value=!1,Q.create({message:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u0443\u0441\u043F\u0435\u0448\u043D\u043E \u0443\u0434\u0430\u043B\u0435\u043D",color:"positive",timeout:1e3})):(Q.create({message:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A\u{1F61E}...",color:"negative",timeout:1e3}),_.value=!1)},l=>{Q.create({message:"\u0427\u0442\u043E-\u0442\u043E \u043F\u043E\u0448\u043B\u043E \u043D\u0435 \u0442\u0430\u043A\u{1F61E}...",color:"negative",timeout:1e3}),console.log(l),_.value=!1})};return ee(()=>{T()}),(a,l)=>(o(),m(ae,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=e=>g.value=e)},{default:s(()=>[u.value?(o(),m(be,{key:0,class:"bg-white text-dark layout",container:"",view:"lhh lpR fff"},{default:s(()=>[i(pe,{modelValue:C.value,"onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),breakpoint:1e4,bordered:"",class:"bg-grey-3 text-dark q-pa-sm",side:"right"},{default:s(()=>[(o(!0),v(f,null,H(n.value,(e,t)=>(o(),m(ve,{key:e==null?void 0:e.name,"bg-color":t%2===0?"blue":"green",stamp:e!=null&&e.createdAt?new Date(e==null?void 0:e.createdAt).toLocaleDateString():void 0,text:q(e),sent:""},null,8,["bg-color","stamp","text"]))),128))]),_:1},8,["modelValue"]),i(_e,null,{default:s(()=>[i(X,{padding:""},{default:s(()=>[i(K,{class:"row items-center q-pb-none"},{default:s(()=>[F("div",Pe,[r(p(u.value.first_name||u.value.username||"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C")+" ",1),F("b",null,"("+p(u.value.chatId)+")",1)]),i(k,{loading:_.value,class:"q-my-sm q-ml-md",color:"red",size:"xs",onClick:$},{default:s(()=>[r(" \u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F ")]),_:1},8,["loading"]),i(me),le(i(k,{dense:"",flat:"",icon:"close",round:""},null,512),[[Ce]])]),_:1}),i(K,null,{default:s(()=>[(o(),v(f,null,H(D,(e,t)=>{var L;return F("div",{key:t,class:"table-item"},[u.value[t]?(o(),v(f,{key:0},[F("b",null,p(e)+": ",1),F("span",null,[t==="averageRating"?(o(),v(f,{key:0},[r(p(u.value[t].toFixed(2)),1)],64)):t==="createdAt"?(o(),v(f,{key:1},[r(p(new Date(u.value[t]).toLocaleDateString("ru-RU")),1)],64)):t==="address"?(o(),v(f,{key:2},[r(p(u.value[t].length)+" ",1),u.value[t].length?(o(),m(N,{key:0,clickable:"",color:"teal",dense:"",icon:"visibility","text-color":"white",onClick:l[1]||(l[1]=S(w=>I(u.value.address),["stop"]))},{default:s(()=>[r(" \u041F\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u0442\u044C ")]),_:1})):y("",!0)],64)):t==="notes"?(o(),v(f,{key:3},[r(p((L=u.value[t])==null?void 0:L.length)+" ",1),u.value.notes.length?(o(),m(N,{key:0,clickable:"",color:"teal",dense:"",icon:"visibility","text-color":"white",onClick:l[2]||(l[2]=S(w=>I(u.value.notes),["stop"]))},{default:s(()=>[r(" \u041F\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u0442\u044C ")]),_:1})):y("",!0),i(N,{clickable:"",color:"teal",dense:"",icon:"edit","text-color":"white",onClick:l[3]||(l[3]=S(w=>E.value=!E.value,["stop"]))},{default:s(()=>[r(" \u041E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0437\u0430\u043C\u0435\u0442\u043A\u0443 ")]),_:1}),E.value?(o(),v("div",ye,[i(Y,{modelValue:b.value,"onUpdate:modelValue":l[4]||(l[4]=w=>b.value=w),filled:"",label:"\u0417\u0430\u043C\u0435\u0442\u043A\u0430",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043A\u0441\u0442 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",type:"textarea"},null,8,["modelValue"]),i(k,{onClick:z},{default:s(()=>[r(" \u041E\u0441\u0442\u0430\u0432\u0438\u0442\u044C ")]),_:1})])):y("",!0)],64)):t==="leftReview"?(o(),v(f,{key:4},[r(p(u.value[t])+" ",1),u.value.reviewFrom.length?(o(),m(N,{key:0,clickable:"",color:"teal",dense:"",icon:"visibility","text-color":"white",onClick:l[5]||(l[5]=S(w=>I(u.value.reviewFrom),["stop"]))},{default:s(()=>[r(" \u041F\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u0442\u044C ")]),_:1})):y("",!0)],64)):t==="receivedReview"?(o(),v(f,{key:5},[r(p(u.value[t])+" ",1),u.value.reviewTo.length?(o(),m(N,{key:0,clickable:"",color:"teal",dense:"",icon:"visibility","text-color":"white",onClick:l[6]||(l[6]=S(w=>I(u.value.reviewTo),["stop"]))},{default:s(()=>[r(" \u041F\u043E\u0441\u043C\u043E\u0442\u0440\u0435\u0442\u044C ")]),_:1})):y("",!0)],64)):(o(),v(f,{key:6},[r(p(u.value[t]),1)],64))])],64)):y("",!0)])}),64)),i(k,{color:u.value.isBlocked?"green":"red",loading:h.value,class:"q-my-sm q-mb-xl",onClick:O},{loading:s(()=>[r(" Loading...")]),default:s(()=>[r(p(u.value.isBlocked?"\u0420\u0430\u0437\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u0442\u044C":"\u0417\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u0442\u044C")+" ",1)]),_:1},8,["color","loading"]),i(fe,{"hidden-fields":["passengerId","city"],list:u.value.orders,mode:j(P).All},null,8,["list","mode"])]),_:1})]),_:1})]),_:1})]),_:1})):(o(),m(Ee,{key:1}))]),_:1},8,["modelValue"]))}});var Be=ue(ke,[["__scopeId","data-v-0fe39d2c"]]);const he=J({__name:"TablePassenger",props:{list:{default:()=>[]},hiddenFields:{default:()=>[]},pagination:{default:()=>({currentPage:1,perPageCount:10,total:0})},mode:{default:P.Page},loading:{type:Boolean,default:!1}},emits:["selectPage","update"],setup(U,{emit:x}){const D=x,n=U,C=d([]),c=d(""),E=M(()=>Math.ceil(n.pagination.total/n.pagination.perPageCount)),b=d(!1),B=M(()=>b.value||n.loading),u=d(n.mode),g=d(),h=d(!1),_=d(!1),I=M(()=>n.hiddenFields.length?R.filter(a=>!n.hiddenFields.includes(a.field)):R),q=M(()=>u.value==P.Page?{rowsPerPage:n.pagination.perPageCount,page:n.pagination.currentPage,rowsNumber:Number(n.pagination.total)}:{rowsPerPage:n.pagination.perPageCount}),z=te(async a=>{c.value=a,b.value=!0;const l=()=>{C.value=[],u.value=n.mode,b.value=!1};if(!c.value){l();return}if(u.value===P.All&&n.mode==P.All){C.value=n.list.filter(e=>e.chatId.toString()==c.value),b.value=!1;return}await A.findPassengerByChatId(c.value,e=>{console.log(e),u.value=P.All,C.value=e?[e]:[],b.value=!1},l())},700),O=async()=>{_.value=!0,u.value===P.All?(await W(R,$.value),_.value=!1):u.value===P.Page&&A.getAllPassengers(async a=>{await W(R,a.data),_.value=!1},a=>{_.value=!1,console.log(a)})},T=a=>{g.value=a,h.value=!0},V=a=>{D("selectPage",a)},$=M(()=>c.value?C.value:n.list);return(a,l)=>(o(),v(f,null,[(o(),m(re,{key:q.value,columns:I.value,loading:B.value,pagination:q.value,rows:$.value,"rows-per-page-options":u.value==j(P).Page?[10]:[5,7,10,15,20,25,50,0],class:"table-passenger","row-key":"name",title:"\u041F\u0430\u0441\u0441\u0430\u0436\u0438\u0440\u044B"},oe({"top-left":s(()=>[i(Y,{"model-value":c.value,debounce:"300",dense:"",outlined:"",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E ID/\u0442\u0435\u043B\u0435\u0444\u043E\u043D\u0443",standout:"","onUpdate:modelValue":j(z)},{append:s(()=>[i(se,{name:"search"})]),_:1},8,["model-value","onUpdate:modelValue"])]),body:s(e=>[i(de,{props:e,class:"table-passenger__row",onClick:t=>{var L;return T((L=e.cols.find(w=>w.name==="chatId"))==null?void 0:L.value)}},{default:s(()=>[(o(!0),v(f,null,H(e.cols,t=>(o(),m(ie,{key:t.name,props:e},{default:s(()=>[t.name=="rating"?(o(),v(f,{key:0},[r(p(t.value)+" \u2B50\uFE0F",1)],64)):(t.name==="chatId"||t.name==="phone")&&!!t.value?(o(),v(f,{key:1},[r(p(t.value)+" ",1),i(ge,{text:t.value.toString()},null,8,["text"])],64)):(o(),v(f,{key:2},[r(p(t.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props","onClick"])]),"top-right":s(()=>[i(k,{disable:!$.value.length,loading:_.value,color:"primary","icon-right":"archive",label:"\u042D\u043A\u0441\u043F\u043E\u0440\u0442 \u0432 csv","no-caps":"",onClick:O},null,8,["disable","loading"])]),_:2},[u.value==j(P).Page?{name:"pagination",fn:s(e=>[F("b",null,p(e.pagination.page),1),r(" \xA0 \u0438\u0437\xA0 "),F("b",null,p(e.pagesNumber),1),e.pagesNumber>2?(o(),m(k,{key:0,disable:e.isFirstPage,color:"grey-8",dense:"",flat:"",icon:"first_page",round:"",onClick:l[0]||(l[0]=t=>V(1))},null,8,["disable"])):y("",!0),i(k,{disable:e.isFirstPage,color:"grey-8",dense:"",flat:"",icon:"chevron_left",round:"",onClick:t=>V(e.pagination.page<=1?1:e.pagination.page-1)},null,8,["disable","onClick"]),i(k,{disable:e.isLastPage,color:"grey-8",dense:"",flat:"",icon:"chevron_right",round:"",onClick:t=>e.pagination.page>=E.value?E.value:V(e.pagination.page+1)},null,8,["disable","onClick"]),e.pagesNumber>2?(o(),m(k,{key:1,disable:e.isLastPage,color:"grey-8",dense:"",flat:"",icon:"last_page",round:"",onClick:l[1]||(l[1]=t=>V(E.value))},null,8,["disable"])):y("",!0)]),key:"0"}:void 0]),1032,["columns","loading","pagination","rows","rows-per-page-options"])),h.value?(o(),m(Be,{key:0,modelValue:h.value,"onUpdate:modelValue":l[2]||(l[2]=e=>h.value=e),"chat-id":g.value},null,8,["modelValue","chat-id"])):y("",!0)],64))}});var we=ue(he,[["__scopeId","data-v-7dcac8e6"]]);const Ge=J({__name:"IndexPage",setup(U){const x=Z("bus"),D=d([]),n=d({currentPage:1,perPageCount:10,total:10}),C=d(!1),c=d(!1),E=d(1),b=async u=>{E.value=u,await B(E.value)},B=async u=>{C.value=!0,A.getPassengers({currentPage:u},g=>{D.value=g.data,n.value={currentPage:g.currentPage,perPageCount:g.perPageCount,total:g.total},c.value=!1,C.value=!1},g=>console.log(g))};return ee(async()=>{c.value=!0,await B(E.value),x.on("update-passengers",()=>B(E.value))}),ne(()=>{x.off("update-passengers",B)}),(u,g)=>(o(),m(X,{class:"row justify-evenly items-start q-pa-lg"},{default:s(()=>[c.value?(o(),m(ce,{key:0,title:"\u0417\u0430\u043A\u0430\u0437\u044B"})):(o(),m(we,{key:n.value,list:D.value,loading:C.value,pagination:n.value,onSelectPage:b},null,8,["list","loading","pagination"]))]),_:1}))}});export{Ge as default};
