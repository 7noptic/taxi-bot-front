import{j as K,c as ee,b as L,a as ae}from"./QCard.440d414a.js";import{Q as O,$ as F}from"./QInput.76567d60.js";import{j as N,i as te,r as v,y as q,w as z,m as c,n as _,p as d,s as E,q as r,ac as f,t as B,u as Q,aK as H,ae as y,A as J,B as G,F as R,aJ as M,z as T,ad as le,aN as ue,aO as se,a as w,af as ne,ag as oe,Q as ie,a9 as re}from"./index.327b4700.js";import{h as A,i as D,Q as pe,a as de,b as ce,T as ge}from"./TableSkeleton.772c2dc2.js";import{M as I}from"./mode.table.8dd12f40.js";import{Q as ve}from"./QChatMessage.e2a8fe9c.js";import{_ as U}from"./CopyText.9704d296.js";import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import{S as j}from"./socket.a55f2fb4.js";import"./use-dark.5b66a423.js";import"./QItem.cb161c91.js";import"./axios.4e4c9ce2.js";import"./QList.421edf4a.js";const X=b=>(ue("data-v-ac910c5a"),b=b(),se(),b),me={class:"chat-header-item"},_e=X(()=>f("span",{class:"chat-header-item__title",textContent:"\u041E\u0431\u0440\u0430\u0442\u0438\u043B\u0441\u044F"},null,-1)),fe=["textContent"],he={class:"chat-header-item"},be=X(()=>f("span",{class:"chat-header-item__title",textContent:"\u041D\u043E\u043C\u0435\u0440 \u0437\u0430\u043A\u0430\u0437\u0430"},null,-1)),Ce=["textContent"],ye=N({__name:"AppealChat",props:{appeal:{default:void 0}},emits:["update:appeal"],setup(b,{emit:P}){te("bus");const C=P,a=b,s=v(null),p=()=>{setTimeout(()=>{s.value=document.querySelector("#chat"),s.value&&s.value.scrollTo({top:s.value.scrollHeight})},10)},n=()=>{if(!s.value||!m.value)return;const t={from:"admin",text:m.value,chatId:a.appeal.from};F.sendMessage(a.appeal._id,t,o=>{C("update:appeal",o.data),m.value=""},o=>{console.log(o)})},u=()=>{!s.value||a.appeal.status===A.Close||F.closeAppealByChatId(a.appeal.from,t=>{C("update:appeal",t),m.value=""},t=>{console.log(t)})},m=v("");return q(()=>{s.value=document.getElementById("chat"),p()}),z(()=>a.appeal,()=>p()),(t,o)=>t.appeal?(c(),_(K,{key:0,class:"chat"},{default:d(()=>{var S;return[r(L,{class:"chat-header"},{default:d(()=>{var l,k;return[f("div",me,[_e,B(":\xA0 "),f("b",{class:"chat-header-item__text",textContent:Q(t.appeal.from)},null,8,fe),r(U,{text:(l=t.appeal.from)==null?void 0:l.toString()},null,8,["text"])]),f("div",he,[be,B(":\xA0 "),f("b",{class:"chat-header-item__text",textContent:Q(t.appeal.numberOrder)},null,8,Ce),r(U,{text:(k=t.appeal.numberOrder)==null?void 0:k.toString()},null,8,["text"])]),r(ee,{class:H([{"chat-header__success--active":t.appeal.status==y(A).Close},"chat-header__success"]),clickable:t.appeal.status==y(A).Open,color:"green",dense:"","text-color":"white",onClick:u},{default:d(()=>[B("\u2705 \u041F\u0440\u043E\u0431\u043B\u0435\u043C\u0430 \u0440\u0435\u0448\u0435\u043D\u0430 ")]),_:1},8,["class","clickable"])]}),_:1}),f("div",{id:"chat",ref_key:"chat",ref:s,class:"chat-body"},[(c(!0),J(R,null,G([...(S=t.appeal)==null?void 0:S.messages].reverse(),(l,k)=>(c(),_(ve,{key:k,"bg-color":l.from==="admin"?"blue":"green",sent:l.from==="admin",stamp:l!=null&&l.date?new Date(l==null?void 0:l.date).toLocaleString():void 0,text:[l.text]},null,8,["bg-color","sent","stamp","text"]))),128))],512),r(L,{class:"chat-footer"},{default:d(()=>[r(O,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=l=>m.value=l),disable:t.appeal.status===y(A).Close,label:t.appeal.status===y(A).Close?"\u041E\u0431\u0440\u0430\u0449\u0435\u043D\u0438\u0435 \u0437\u0430\u043A\u0440\u044B\u0442\u043E":"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043A\u0441\u0442",class:"chat-footer__input",outlined:"",onKeyup:M(n,["enter"])},null,8,["modelValue","disable","label"]),r(T,{disable:t.appeal.status===y(A).Close,class:"chat-footer__button",label:"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C",standout:"",onClick:le(n,["stop"]),onKeyup:M(n,["enter"])},null,8,["disable"])]),_:1})]}),_:1})):E("",!0)}});var Pe=W(ye,[["__scopeId","data-v-ac910c5a"]]);const ke={class:"appeal-chat"},Ae=N({__name:"TableAppeal",props:{list:{default:()=>[]},hiddenFields:{default:()=>[]},pagination:{default:()=>({currentPage:1,perPageCount:10,total:0})},mode:{default:I.Page},loading:{type:Boolean,default:!1}},emits:["selectPage","update"],setup(b,{emit:P}){const C=P,a=b,s=v([]),p=v(""),n=w(()=>Math.ceil(a.pagination.total/a.pagination.perPageCount)),u=v(!1),m=w(()=>u.value||a.loading),t=v(a.mode),o=v(),S=w(()=>a.hiddenFields.length?D.filter(g=>!a.hiddenFields.includes(g.field)):D),l=w(()=>t.value==I.Page?{rowsPerPage:a.pagination.perPageCount,page:a.pagination.currentPage,rowsNumber:Number(a.pagination.total)}:{rowsPerPage:a.pagination.perPageCount}),k=ne(async g=>{p.value=g,u.value=!0;const i=()=>{s.value=[],t.value=a.mode,u.value=!1};if(!p.value){i();return}await F.findByNumberAppeal(p.value,e=>{t.value=I.All,s.value=e,u.value=!1},i())},700),Y=g=>{o.value=g},x=g=>{C("selectPage",g)},Z=w(()=>p.value?s.value:a.list);return z(()=>a.list,g=>{if(o.value){const i=g.findIndex(e=>{var h;return e._id===((h=o.value)==null?void 0:h._id)});i>-1&&(o.value=g[i])}}),(g,i)=>(c(),_(K,{class:"appeal"},{default:d(()=>[(c(),_(pe,{key:l.value,columns:S.value,loading:m.value,pagination:l.value,rows:Z.value,"rows-per-page-options":[10],class:"appeal-table","row-key":"name",title:"\u041E\u0431\u0440\u0430\u0449\u0435\u043D\u0438\u044F"},oe({"top-left":d(()=>[r(O,{"model-value":p.value,debounce:"300",dense:"",outlined:"",placeholder:"\u041F\u043E\u0438\u0441\u043A \u043F\u043E ID",standout:"","onUpdate:modelValue":y(k)},{append:d(()=>[r(ie,{name:"search"})]),_:1},8,["model-value","onUpdate:modelValue"])]),body:d(e=>{var h,V;return[r(ce,{class:H([{"appeal-table__row--active":((h=o.value)==null?void 0:h._id)===((V=e==null?void 0:e.row)==null?void 0:V._id)},"appeal-table__row"]),props:e,onClick:$=>Y(e.row)},{default:d(()=>[(c(!0),J(R,null,G(e.cols,$=>(c(),_(de,{key:$.name,props:e},{default:d(()=>[B(Q($.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["class","props","onClick"])]}),_:2},[t.value==y(I).Page?{name:"pagination",fn:d(e=>[f("b",null,Q(e.pagination.page),1),B(" \xA0 \u0438\u0437\xA0 "),f("b",null,Q(e.pagesNumber),1),e.pagesNumber>2?(c(),_(T,{key:0,disable:e.isFirstPage,color:"grey-8",dense:"",flat:"",icon:"first_page",round:"",onClick:i[0]||(i[0]=h=>x(1))},null,8,["disable"])):E("",!0),r(T,{disable:e.isFirstPage,color:"grey-8",dense:"",flat:"",icon:"chevron_left",round:"",onClick:h=>x(e.pagination.page<=1?1:e.pagination.page-1)},null,8,["disable","onClick"]),r(T,{disable:e.isLastPage,color:"grey-8",dense:"",flat:"",icon:"chevron_right",round:"",onClick:h=>e.pagination.page>=n.value?n.value:x(e.pagination.page+1)},null,8,["disable","onClick"]),e.pagesNumber>2?(c(),_(T,{key:1,disable:e.isLastPage,color:"grey-8",dense:"",flat:"",icon:"last_page",round:"",onClick:i[1]||(i[1]=h=>x(n.value))},null,8,["disable"])):E("",!0)]),key:"0"}:void 0]),1032,["columns","loading","pagination","rows"])),f("div",ke,[r(Pe,{appeal:o.value,"onUpdate:appeal":[i[2]||(i[2]=e=>o.value=e),i[3]||(i[3]=e=>x(l.value.currentPage))]},null,8,["appeal"])])]),_:1}))}});var xe=W(Ae,[["__scopeId","data-v-80d1a084"]]);const De=N({__name:"HelpPage",setup(b){const P=v([]),C=v({currentPage:1,perPageCount:10,total:10}),a=v(!1),s=v(!1),p=async n=>{a.value=!0,F.getAppeals({currentPage:n},u=>{P.value=u.data,C.value={currentPage:u.currentPage,perPageCount:u.perPageCount,total:u.total},s.value=!1,a.value=!1},u=>console.log(u))};return q(async()=>{var n;s.value=!0,await p(1),(n=j.client)==null||n.on("update-appeal-client",u=>{p(C.value.currentPage)})}),re(()=>{var n;(n=j.client)==null||n.off("update-appeal-client")}),(n,u)=>(c(),_(ae,{class:"row justify-evenly items-start q-pa-lg"},{default:d(()=>[s.value?(c(),_(ge,{key:0,title:"\u0417\u0430\u043A\u0430\u0437\u044B"})):(c(),_(xe,{key:1,list:P.value,loading:a.value,pagination:C.value,onSelectPage:u[0]||(u[0]=m=>p(m))},null,8,["list","loading","pagination"]))]),_:1}))}});export{De as default};
